---
- name: Ensure qrgenix namespace exists
  kubernetes.core.k8s:
    api_version: v1
    kind: Namespace
    name: qrgenix
    state: present

- name: Ensure /tmp/k8s exists
  file:
    path: /tmp/k8s
    state: directory
    mode: "0755"

- name: Copy & extract manifests
  unarchive:
    src: /staging.tar.gz
    dest: /tmp/k8s
    remote_src: true

- name: Apply + prune selected kinds
  shell: |
    kubectl apply -f /tmp/k8s --prune \
      --prune-whitelist=apps/v1/Deployment \
      --prune-whitelist=v1/Service \
      --prune-whitelist=networking.k8s.io/v1/Ingress
  args:
    executable: /bin/bash
