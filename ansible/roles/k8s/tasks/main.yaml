- name: ⛔ Remove old /tmp/k8s staging dir (if root-owned)
  file:
    path: /tmp/k8s
    state: absent
  become: true

- name: 📁 Create /tmp/k8s directory on app node
  file:
    path: /tmp/k8s
    state: directory
    mode: "0755"

- name: 🗃️ Tar up manifests on control machine (localhost)
  archive:
    path: "{{ playbook_dir }}/../k8s/staging/"
    dest: "/tmp/k8s_manifests.tar.gz"
    format: gz
  delegate_to: localhost
  run_once: true

- name: 🚚 Copy manifest archive to app node
  copy:
    src: "/tmp/k8s_manifests.tar.gz"
    dest: "/tmp/k8s/"
  become: false

- name: 📦 Extract manifest archive on app node
  unarchive:
    src: "/tmp/k8s/k8s_manifests.tar.gz"
    dest: "/tmp/k8s/"
    remote_src: true

- name: 🧹 Clean up archive from app node
  file:
    path: "/tmp/k8s/k8s_manifests.tar.gz"
    state: absent
